---
title: "Planning Dashboard"
output: 
  flexdashboard::flex_dashboard:
    logo: glasses_logo_white_small.png
    favicon: glasses_logo_favicon.jpg
    orientation: columns
    vertical_layout: fill
---



```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(readxl)
library(scales)
library(ggrepel)
library(plotly)
```

Stock
=======================================================================

Column {data-width=850}
-----------------------------------------------------------------------

### OOS % by Contribution Code

```{r}
oos_summary <- read_csv("oos_summary.csv")

oos_summary <- oos_summary %>%
  select(CC, ATP, ITR)

oos_summary <- oos_summary %>%
  gather(ATP, ITR, key = "TYPE", value = "OOS")

oos_summary$OOS <- oos_summary$OOS * 100

p <- ggplot(data = oos_summary, aes(fill = TYPE, y = OOS, x = CC)) +
  geom_bar(position = "dodge", stat = "identity") +
  theme(legend.position = "none") +
  #scale_y_continuous(limits = c(0, 50)) +
  theme_minimal() +
  scale_fill_manual("TYPE", values = c("ATP" = "#005193", "ITR" = "#3AAADC")) +
  geom_text(aes(y = OOS + .5,    # nudge above top of bar
                label = paste0(OOS, '%')),    # prettify
                position = position_dodge(width = .9), 
                size = 3)

p <- p + theme(axis.title.x = element_blank(),
               axis.title.y = element_blank(),
               legend.position = "bottom")

ggplotly(p) %>%
  layout(legend = list(orientation = "h", y = -.05, x = .41))

```

### Historical ATP OOS %

```{r}
hist_oos <-
  read_excel("hist_oos_gl.xlsx")

oos_plot <- hist_oos %>%
  select(`ATP OOS %`, DATE, CC) %>%
  arrange(desc(`ATP OOS %`))

oos_plot$DATE <- as.Date(as.POSIXct(oos_plot$DATE))

oos_plot$facet = factor(oos_plot$CC,
                        levels = c("A",
                                   "B",
                                   "C",
                                   "D",
                                   "E",
                                   "Grand Total"))

p <-
  ggplot(data = oos_plot, aes(x = DATE, y = `ATP OOS %`, group = CC)) +
  geom_line(size = 0.45, color = "#3AAADC") +
  scale_y_continuous(labels = percent) +
  theme(legend.position = "none") +
  theme_bw()

p <- p + facet_wrap(~ facet, nr = 2) +
  theme(strip.background = element_rect(fill = "#005192"),
        strip.text = element_text(size = 10,
                                  color = "white"),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())

ggplotly(p)

```

Column {.tabset}
-----------------------------------------------------------------------

### Top 5 Brands OOS %

```{r}

```

### NPI OOS % by Brand

```{r}

```

Sales
=======================================================================

Column {data-width=650}
-----------------------------------------------------------------------

### Gross Sales XTD

```{r}

```

### Gross Sales vs LY

```{r}

```

Column {.tabset}
-----------------------------------------------------------------------

### Gross Sales YTD by Brand

```{r}

```

### Best Sellers

```{r}

```

Forecast
=======================================================================

Column {data-width=500}
-----------------------------------------------------------------------

### Forecast Accuracy - DPM - 4 Week Lag

```{r}

```

### Forecast Accuracy - DPM - 13 Week Lag

```{r}

```

Column {data-width=500}
-----------------------------------------------------------------------

### Forecast Accuracy - isaiah.io - 4 Week Lag

```{r}

```

### Forecast Accuracy - isaiah.io - 13 Week Lag

```{r}

```

Detail
=======================================================================

Column {data-width=1000}
-----------------------------------------------------------------------

### UPC Level Detail

```{r}

```

